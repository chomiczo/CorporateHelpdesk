@model CorporateHelpdesk.Models.Ticket

<div class="container mt-4">
    <h1>Szczegóły zgłoszenia: @Model.Title</h1>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Opis</dt>
        <dd class="col-sm-10">@Model.Description</dd>
        <dt class="col-sm-2">Status</dt>
        <dd class="col-sm-10"><span class="badge bg-info">@Model.Status</span></dd>
    </dl>

    @* Przycisk zmiany statusu dla Admina *@
    @if (User.Identity.Name == "admin@admin.com" && Model.Status != "Zamknięte")
    {
        <form asp-action="ChangeStatus" method="post" class="mt-3 mb-4">
            <input type="hidden" name="id" value="@Model.Id" />
            <input type="hidden" name="newStatus" value="Zamknięte" />
            <button type="submit" class="btn btn-success shadow-sm">✅ Oznacz jako rozwiązane</button>
        </form>
    }

    <h3 class="mt-5">💬 Komentarze</h3>
    <div class="list-group mb-4">
        @if (!Model.Comments.Any())
        {
            <p class="text-muted">Brak komentarzy. Bądź pierwszy!</p>
        }
        @foreach (var comment in Model.Comments.OrderBy(c => c.CreatedAt))
        {
            <div class="list-group-item list-group-item-action flex-column align-items-start shadow-sm mb-2 rounded">
                <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1 fw-bold">@comment.Author?.UserName</h6>
                    @* Tutaj poprawiłem błąd ToString, który miałeś na czerwono *@
                    <small class="text-muted">@(((DateTime)comment.CreatedAt).ToString("yyyy-MM-dd HH:mm"))</small>
                </div>
                <p class="mb-1">@comment.Text</p>
            </div>
        }
    </div>

    <div class="card p-3 shadow-sm border-0 bg-light">
        <h5>Dodaj komentarz</h5>
        <form asp-action="AddComment" method="post">
            <input type="hidden" name="ticketId" value="@Model.Id" />
            <div class="form-group mb-3">
                <textarea name="commentText" class="form-control" rows="3" placeholder="Wpisz treść..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Wyślij</button>
            <a asp-action="Index" class="btn btn-secondary">Powrót do listy</a>
        </form>
    </div>
</div>